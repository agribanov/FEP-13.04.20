"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}document.addEventListener("DOMContentLoaded",function(){console.log("app started"),new Controller});var contactsUrl="https://5dd3d5ba8b5e080014dc4bfa.mockapi.io/todos",Controller=function(){function t(){var e=this;_classCallCheck(this,t),this.collection=new ToDoCollection(contactsUrl),this.listView=new ListView({onDelete:function(t){e.collection.delete(t).then(function(){return e.renderData()})},onToggle:function(t){e.collection.get(t).toggle().then(function(){return e.renderData()})}}),this.formView=new FormView({onSave:function(t){e.collection.add(t).then(function(){return e.renderData()})}}),this.container=document.getElementById("root"),this.container.append(this.listView.el),this.container.append(this.formView.el),this.refreshData()}return _createClass(t,[{key:"refreshData",value:function(){var t=this;this.collection.fetch().then(function(){return t.renderData()})}},{key:"renderData",value:function(){this.listView.render(this.collection.list),console.log(this.collection.list)}}]),t}(),ToDoCollection=function(){function e(t){_classCallCheck(this,e),this.url=t,this.list=[],this.setData=this.setData.bind(this),console.log("collection",t)}function t(){return n.apply(this,arguments)}var n;return _createClass(e,[{key:"fetch",value:(n=function(){var e=this;return console.log("fetching"),fetch(this.url).then(function(t){return t.json()}).then(this.setData).then(function(){var t=e.list[0];console.log(t,JSON.stringify(t))})},t.toString=function(){return n.toString()},t)},{key:"setData",value:function(t){var e=this;return this.list=t.map(function(t){return new ToDoModel(e.url,t)})}},{key:"delete",value:function(t){var e=this,n=this.get(t);return n.delete().then(function(){return e.list=e.list.filter(function(t){return t!==n})})}},{key:"get",value:function(e){return this.list.find(function(t){return t.id==e})}},{key:"add",value:function(t){var e=this;return t.completed=!1,fetch("".concat(this.url),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(t){return t.json()}).then(function(t){return e.list.push(new ToDoModel(e.url,t))})}}]),e}(),urlWeakMap=new WeakMap,ToDoModel=function(){function n(t,e){_classCallCheck(this,n),this.url=t,this.setData(e),console.log("model constructor",this.url)}return _createClass(n,[{key:"url",get:function(){return urlWeakMap.get(this)},set:function(t){urlWeakMap.set(this,t)}}]),_createClass(n,[{key:"setData",value:function(t){Object.assign(this,t)}},{key:"delete",value:function(){return fetch("".concat(this.url,"/").concat(this.id),{method:"DELETE"})}},{key:"toggle",value:function(){return this.completed=!this.completed,fetch("".concat(this.url,"/").concat(this.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(this)})}}]),n}(),FormView=function(){function e(t){_classCallCheck(this,e),this.config=t,this.createElement(),this.el.addEventListener("submit",this.onSubmit.bind(this)),this.titleInput=this.el.querySelector("#taskNameInput")}return _createClass(e,[{key:"onSubmit",value:function(t){t.preventDefault(),this.config.onSave({title:this.titleInput.value})}},{key:"createElement",value:function(){this.el=document.createElement("form"),this.el.innerHTML='\n            <div class="row">\n                <div class="ten columns">\n                    <input type="text" name="title" id="taskNameInput" class="u-full-width">\n                </div>\n                <div class="two columns">\n                    <input type="submit" class="u-full-width" value="Add">\n                </div>\n            </div>\n        '}}]),e}(),ListView=function(){function e(t){_classCallCheck(this,e),this.config=t,this.createElement()}return _createClass(e,[{key:"createElement",value:function(){this.el=document.createElement("div"),this.el.className="task-list u-full-width",this.el.addEventListener("click",this.onListClick.bind(this))}},{key:"onListClick",value:function(t){switch(console.log(t,this),!0){case t.target.classList.contains("delete-btn"):this.config.onDelete(t.target.parentNode.dataset.id);break;case t.target.classList.contains("task-item"):this.config.onToggle(t.target.dataset.id)}}},{key:"render",value:function(t){this.el.innerHTML=t.map(this.renderItem).join("\n")}},{key:"renderItem",value:function(t){var e=t.completed?"done":"";return'<div class="task-item u-full-width '.concat(e,'" data-id="').concat(t.id,'">\n                    ').concat(t.title,"\n                    <span class='delete-btn'>x</span>\n                </div>")}}]),e}();